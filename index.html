<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DIGO PHARAONIC 0.07 PRO SYSTEM</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#b8892d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="BIDO">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2344/2344132.png">

  <style>
    body {
      margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
      background: radial-gradient(circle at top, #1a1208, #000);
      font-family: "Cinzel", "Trajan Pro", serif; overflow: hidden;
    }
    .calculator {
      width: 360px; padding: 22px; border-radius: 28px;
      background: radial-gradient(circle at top, rgba(255,255,255,.08), rgba(0,0,0,.9)),
                  linear-gradient(145deg, #5a4327, #2d1f11);
      box-shadow: inset 0 0 70px rgba(0,0,0,.95), 0 40px 80px rgba(0,0,0,.95);
      color: #e6c77a;
    }
    .logo { text-align: center; margin-bottom: 15px; }
    .eye { font-size: 42px; text-shadow: 0 0 10px #000; cursor: default; }
    .brand {
      font-size: 32px; letter-spacing: 4px;
      background: linear-gradient(145deg, #f6e27a, #b8892d);
      -webkit-background-clip: text; color: transparent; font-weight: bold;
    }

    .display {
      background: rgba(0,0,0,.75); padding: 20px; border-radius: 16px;
      box-shadow: inset 0 0 35px rgba(0,0,0,.95); min-height: 80px;
    }
    #exp {
      font-size: 16px; opacity: .75; min-height: 20px;
      text-align: left; direction: ltr; margin-bottom: 5px; color: #f2d68f;
      word-break: break-all;
    }
    #res {
      font-size: 36px; text-align: right; overflow: hidden;
      font-weight: bold; color: #f6e27a; text-shadow: 0 0 5px rgba(246, 226, 122, 0.3);
      word-break: break-all;
    }

    .keys { margin-top: 22px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    button {
      height: 58px; border: none; border-radius: 14px; font-size: 20px; color: #f2d68f; cursor: pointer;
      background: linear-gradient(rgba(255,255,255,.1), rgba(0,0,0,.6)), linear-gradient(145deg, #6b5232, #3a2614);
      box-shadow: inset 0 4px 4px rgba(0,0,0,0.5), 0 4px 8px rgba(0,0,0,.8);
      transition: all 0.1s ease;
      user-select: none;
    }
    button:active { transform: scale(0.92); filter: brightness(1.3); }

    .eq { grid-column: span 2; background: linear-gradient(145deg, #f6e27a, #b8892d); color: #000; font-weight: bold; font-size: 24px; }
    .ac { background: linear-gradient(rgba(200,50,50,.3), rgba(0,0,0,.6)); color: #ff9999; }
    .c  { background: linear-gradient(rgba(200,120,50,.22), rgba(0,0,0,.6)); color: #ffd2a6; }
    .del { color: #ff9999; }

    .footer { margin-top: 22px; text-align: center; }
    .footer-top { font-size: 13px; color: #b8892d; margin-bottom: 6px; letter-spacing: 1px; }
    .footer-main { font-size: 19px; font-weight: bold; color: #f6e27a; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
  </style>
</head>
<body>

<div class="calculator">
  <div class="logo">
    <div class="eye">ð“‚€</div>
    <div class="brand">BIDO</div>
  </div>

  <div class="display">
    <div id="exp" aria-label="Expression"></div>
    <div id="res" aria-label="Result">0</div>
  </div>

  <div class="keys" aria-label="Calculator keys">
    <button class="ac" type="button">AC</button>
    <button class="c" type="button">C</button>
    <button type="button">Â±</button>
    <button class="del" type="button">âŒ«</button>

    <button type="button">%</button>
    <button type="button">Ã·</button>
    <button type="button">Ã—</button>
    <button type="button">âˆ’</button>

    <button type="button">7</button><button type="button">8</button><button type="button">9</button>
    <button type="button">+</button>

    <button type="button">4</button><button type="button">5</button><button type="button">6</button>
    <button type="button">00</button>

    <button type="button">1</button><button type="button">2</button><button type="button">3</button>
    <button type="button">.</button>

    <button type="button">0.03</button>
    <button type="button">0</button>
    <button class="eq" type="button">=</button>
  </div>

  <div class="footer">
    <div class="footer-top">DESIGN BY : MAHMOUD BIDEAR</div>
    <div class="footer-main">Ø·ÙˆØ±Ù‡Ø§ Ø¨Ù„Ù…Ø³Ø© Ù…Ù„ÙƒÙŠØ© | Ø£. Ù…Ø­Ù…ÙˆØ¯ Ø¨Ø¯ÙŠØ±</div>
  </div>
</div>

<script>
  // --- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„ØªØ¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª ---
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('SW Registered'))
        .catch(err => console.log('SW Registration Failed', err));
    });
  }

  // --- ÙƒÙˆØ¯ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ---
  let data = "";
  const expDiv = document.getElementById("exp");
  const resDiv = document.getElementById("res");
  const OPS = new Set(["+", "âˆ’", "Ã—", "Ã·"]);
  const isDigit = (c) => /[0-9]/.test(c);

  function formatNumber(n) {
    if (!isFinite(n)) return "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ 0";
    const rounded = Number(n.toFixed(10));
    return (Object.is(rounded, -0) ? 0 : rounded).toString();
  }

  function updateDisplay() {
    expDiv.innerText = data;
    const preview = tryEvaluate(data);
    if (preview.ok) resDiv.innerText = formatNumber(preview.value);
    else if (!data) resDiv.innerText = "0";
  }

  function lastIndexOfAnyOperator(expr) {
    for (let i = expr.length - 1; i >= 0; i--) {
      if (OPS.has(expr[i])) return i;
    }
    return -1;
  }

  function getCurrentChunk(expr) {
    const idx = lastIndexOfAnyOperator(expr);
    return expr.slice(idx + 1);
  }

  function replaceCurrentChunk(newChunk) {
    const idx = lastIndexOfAnyOperator(data);
    data = data.slice(0, idx + 1) + newChunk;
  }

  function canAddDot() {
    const chunk = getCurrentChunk(data);
    if (chunk === "" || chunk === "âˆ’") return true;
    return !chunk.includes(".");
  }

  function canAddPercent() {
    if (!data) return false;
    return isDigit(data.slice(-1));
  }

  function clearEntry() {
    if (!data) return;
    const last = data.slice(-1);
    if (OPS.has(last)) {
      data = data.slice(0, -1);
      return;
    }
    const idx = lastIndexOfAnyOperator(data);
    const prefix = data.slice(0, idx + 1);
    let chunk = data.slice(idx + 1);
    if (chunk.endsWith("%")) {
      chunk = chunk.slice(0, -1);
      data = prefix + chunk;
      return;
    }
    chunk = chunk.slice(0, -1);
    if (chunk === "" || chunk === "âˆ’" || chunk === "0.") {
      data = prefix;
      return;
    }
    data = prefix + chunk;
  }

  function toggleSign() {
    if (!data) { data = "âˆ’"; updateDisplay(); return; }
    const idx = lastIndexOfAnyOperator(data);
    let chunk = data.slice(idx + 1);
    if (chunk === "") {
      data += "âˆ’";
      updateDisplay();
      return;
    }
    if (chunk.startsWith("âˆ’")) {
      chunk = chunk.slice(1);
      replaceCurrentChunk(chunk);
      updateDisplay();
      return;
    }
    replaceCurrentChunk("âˆ’" + chunk);
    updateDisplay();
  }

  function appendNumberString(numStr) {
    const chunk = getCurrentChunk(data);
    if (chunk === "0" && !chunk.includes(".")) {
      data = data.slice(0, -1) + numStr;
    } else if (chunk === "" || chunk === "âˆ’") {
      data += numStr;
    } else {
      data += numStr;
    }
    updateDisplay();
  }

  function handleInput(v) {
    const lastChar = data.slice(-1);
    if (v === "AC") { data = ""; expDiv.innerText = ""; resDiv.innerText = "0"; return; }
    if (v === "C") { clearEntry(); updateDisplay(); return; }
    if (v === "Â±") { toggleSign(); return; }
    if (v === "âŒ«") { data = data.slice(0, -1); updateDisplay(); return; }
    if (v === "=") {
      const out = tryEvaluate(data);
      if (out.ok) {
        const formatted = formatNumber(out.value);
        resDiv.innerText = formatted;
        data = formatted;
        expDiv.innerText = "";
      } else {
        resDiv.innerText = out.message || "Ø®Ø·Ø£";
        data = "";
        expDiv.innerText = "";
      }
      return;
    }
    if (v === "0.03") { appendNumberString("0.03"); return; }
    if (/[0-9]/.test(v) || v === "00") {
      const chunk = getCurrentChunk(data);
      if (v === "00") {
        if (chunk === "" || chunk === "âˆ’") { data += "0"; updateDisplay(); return; }
      }
      if (chunk === "0" && v === "0") return;
      if (chunk === "0" && v !== "0" && v !== "00" && !chunk.includes(".")) {
        data = data.slice(0, -1) + v;
      } else {
        data += v;
      }
      updateDisplay();
      return;
    }
    if (v === ".") {
      if (!canAddDot()) return;
      const chunk = getCurrentChunk(data);
      if (chunk === "" || chunk === "âˆ’") data += "0.";
      else data += ".";
      updateDisplay();
      return;
    }
    if (v === "%") { if (!canAddPercent()) return; data += "%"; updateDisplay(); return; }
    if (OPS.has(v)) {
      if (!data) { if (v === "âˆ’") { data = "âˆ’"; updateDisplay(); } return; }
      if (OPS.has(lastChar)) { data = data.slice(0, -1) + v; updateDisplay(); return; }
      if (lastChar === ".") return;
      data += v;
      updateDisplay();
      return;
    }
  }

  function tokenize(expr) {
    const tokens = [];
    let i = 0;
    const peek = () => expr[i];
    const next = () => expr[i++];
    while (i < expr.length) {
      const ch = peek();
      if (ch === " ") { i++; continue; }
      if (ch === "+") { tokens.push({type:"op", value:"+"}); i++; continue; }
      if (ch === "Ã—") { tokens.push({type:"op", value:"*"}); i++; continue; }
      if (ch === "Ã·") { tokens.push({type:"op", value:"/"}); i++; continue; }
      if (ch === "âˆ’") {
        const prev = tokens[tokens.length - 1];
        if (!prev || prev.type === "op") {
          i++; let numStr = "-";
          if (peek() === ".") numStr += "0";
          while (i < expr.length && (isDigit(peek()) || peek() === ".")) numStr += next();
          tokens.push({type:"num", value:Number(numStr)});
        } else { tokens.push({type:"op", value:"-"}); i++; }
        continue;
      }
      if (isDigit(ch) || ch === ".") {
        let numStr = ""; if (ch === ".") numStr = "0";
        while (i < expr.length && (isDigit(peek()) || peek() === ".")) numStr += next();
        tokens.push({type:"num", value:Number(numStr)});
        continue;
      }
      if (ch === "%") {
        const prev = tokens[tokens.length - 1];
        if (prev && prev.type === "num") prev.rawPercent = true;
        i++; continue;
      }
      i++;
    }
    return applyCalculatorPercent(tokens);
  }

  function applyCalculatorPercent(tokens) {
    for (let i = 0; i < tokens.length; i++) {
      const t = tokens[i];
      if (t.type === "num" && t.rawPercent) {
        const opTok = tokens[i - 1], leftTok = tokens[i - 2], b = t.value / 100;
        if (opTok && (opTok.value === "+" || opTok.value === "-") && leftTok && leftTok.type === "num") {
          t.value = leftTok.value * b;
        } else { t.value = b; }
        delete t.rawPercent;
      }
    }
    return tokens;
  }

  function toRPN(tokens) {
    const out = [], stack = [], prec = { "+":1, "-":1, "*":2, "/":2 };
    for (const t of tokens) {
      if (t.type === "num") out.push(t);
      else {
        while (stack.length && prec[stack[stack.length-1].value] >= prec[t.value]) out.push(stack.pop());
        stack.push(t);
      }
    }
    while (stack.length) out.push(stack.pop());
    return out;
  }

  function evalRPN(rpn) {
    const st = [];
    for (const t of rpn) {
      if (t.type === "num") st.push(t.value);
      else {
        const b = st.pop(), a = st.pop();
        if (a === undefined || b === undefined) return NaN;
        if (t.value === "+") st.push(a + b);
        else if (t.value === "-") st.push(a - b);
        else if (t.value === "*") st.push(a * b);
        else if (t.value === "/") st.push(a / b);
      }
    }
    return st[0];
  }

  function tryEvaluate(expr) {
    if (!expr) return { ok:false };
    try {
      const tokens = tokenize(expr);
      const value = evalRPN(toRPN(tokens));
      return isFinite(value) ? { ok:true, value } : { ok:false, message:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ 0" };
    } catch (e) { return { ok:false }; }
  }

  document.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", () => handleInput(btn.innerText.trim()));
  });
</script>

</body>
</html>
